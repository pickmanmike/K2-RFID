diff --git a/Windows/CFS-RFID/Utils.cs b/Windows/CFS-RFID/Utils.cs
--- a/Windows/CFS-RFID/Utils.cs
+++ b/Windows/CFS-RFID/Utils.cs
@@ -1196,7 +1196,8 @@
                     loops++;
                     if (loops > maxLoops) break;
 
-                    string url = string.Format("{0}{1}?limit={2}&offset={3}", baseUrl, path, limit, offset);
+                    string sep = path.Contains("?") ? "&" : "?";
+                    string url = string.Format("{0}{1}{2}limit={3}&offset={4}", baseUrl, path, sep, limit, offset);
                     string res = PerformSmRequest(url, "GET");
                     if (res == null) return null;
 
@@ -1408,12 +1409,27 @@
                 // Filament (prefer article_number match)
                 // ---------------------
                 int filamentId = -1;
-                JArray filaments = PerformSmPagedGet(baseUrl, "/filament");
+
+                // Query by article_number first to avoid pulling the entire filament table.
+                // Spoolman supports a partial, case-insensitive search term on `article_number`
+                // (we still verify exact match below).
+                bool usedFilteredFilamentQuery = true;
+                JArray filaments = PerformSmPagedGet(baseUrl, "/filament?article_number=" + Uri.EscapeDataString(variantArticleNumber));
+                if (filaments == null)
+                {
+                    // Fallback: fetch all filaments (older versions / unusual reverse proxy behavior)
+                    usedFilteredFilamentQuery = false;
+                    filaments = PerformSmPagedGet(baseUrl, "/filament");
+                }
+
                 if (filaments == null)
                 {
                     result.Message = "Error: Unable to query filaments";
                     return result;
                 }
+
+                // Lazy-load full list only if we need deep fallback matching.
+                JArray allFilaments = usedFilteredFilamentQuery ? null : filaments;
 
                 // Prefer an exact match on the color-variant article number.
                 foreach (JObject f in filaments)
@@ -1432,20 +1448,24 @@
                 // Legacy/compat fallback: older versions may have created a filament with the *master* article_number but the right color_hex.
                 if (filamentId == -1)
                 {
-                    foreach (JObject f in filaments)
-                    {
-                        string an = (f["article_number"] != null && f["article_number"].Type != JTokenType.Null) ? f["article_number"].ToString() : string.Empty;
-                        if (string.IsNullOrEmpty(an) || !string.Equals(an, masterArticleNumber, StringComparison.OrdinalIgnoreCase)) continue;
-
-                        int vIdCheck = (f["vendor"] != null && f["vendor"].Type != JTokenType.Null)
-                                       ? (int)f["vendor"]["id"] : -1;
-                        if (vIdCheck != vendorId) continue;
-
-                        string c = f["color_hex"] != null ? f["color_hex"].ToString() : string.Empty;
-                        if (string.Equals(NormalizeColorHex6(c), colorHex, StringComparison.OrdinalIgnoreCase))
+                    if (allFilaments == null) allFilaments = PerformSmPagedGet(baseUrl, "/filament");
+                    if (allFilaments != null)
+                    {
+                        foreach (JObject f in allFilaments)
                         {
-                            filamentId = (int)f["id"];
-                            break;
+                            string an = (f["article_number"] != null && f["article_number"].Type != JTokenType.Null) ? f["article_number"].ToString() : string.Empty;
+                            if (string.IsNullOrEmpty(an) || !string.Equals(an, masterArticleNumber, StringComparison.OrdinalIgnoreCase)) continue;
+
+                            int vIdCheck = (f["vendor"] != null && f["vendor"].Type != JTokenType.Null)
+                                           ? (int)f["vendor"]["id"] : -1;
+                            if (vIdCheck != vendorId) continue;
+
+                            string c = f["color_hex"] != null ? f["color_hex"].ToString() : string.Empty;
+                            if (string.Equals(NormalizeColorHex6(c), colorHex, StringComparison.OrdinalIgnoreCase))
+                            {
+                                filamentId = (int)f["id"];
+                                break;
+                            }
                         }
                     }
                 }
@@ -1453,21 +1473,25 @@
                 // Fallback match: vendor + name + color
                 if (filamentId == -1)
                 {
-                    foreach (JObject f in filaments)
-                    {
-                        int vIdCheck = (f["vendor"] != null && f["vendor"].Type != JTokenType.Null)
-                                       ? (int)f["vendor"]["id"] : -1;
-
-                        string n = f["name"] != null ? f["name"].ToString() : string.Empty;
-                        string c = f["color_hex"] != null ? f["color_hex"].ToString() : string.Empty;
-
-                        if (vIdCheck == vendorId &&
-                            (string.Equals(n, filamentNameWithColor, StringComparison.OrdinalIgnoreCase) ||
-                            string.Equals(n, filamentName, StringComparison.OrdinalIgnoreCase)) &&
-                            string.Equals(NormalizeColorHex6(c), colorHex, StringComparison.OrdinalIgnoreCase))
+                    if (allFilaments == null) allFilaments = PerformSmPagedGet(baseUrl, "/filament");
+                    if (allFilaments != null)
+                    {
+                        foreach (JObject f in allFilaments)
                         {
-                            filamentId = (int)f["id"];
-                            break;
+                            int vIdCheck = (f["vendor"] != null && f["vendor"].Type != JTokenType.Null)
+                                           ? (int)f["vendor"]["id"] : -1;
+
+                            string n = f["name"] != null ? f["name"].ToString() : string.Empty;
+                            string c = f["color_hex"] != null ? f["color_hex"].ToString() : string.Empty;
+
+                            if (vIdCheck == vendorId &&
+                                (string.Equals(n, filamentNameWithColor, StringComparison.OrdinalIgnoreCase) ||
+                                string.Equals(n, filamentName, StringComparison.OrdinalIgnoreCase)) &&
+                                string.Equals(NormalizeColorHex6(c), colorHex, StringComparison.OrdinalIgnoreCase))
+                            {
+                                filamentId = (int)f["id"];
+                                break;
+                            }
                         }
                     }
                 }
@@ -1479,6 +1503,15 @@
                     fBodyDict.Add("vendor_id", vendorId);
                     fBodyDict.Add("color_hex", colorHex);
                     fBodyDict.Add("article_number", variantArticleNumber);
+                    // Optional: set external_id for integrations / stable joins (if supported by your Spoolman version).
+                    // Hidden setting: HKCU\CFS RFID\Settings\SmExternalIdPrefix (String)
+                    // Default matches the Creality->Spoolman sync script: "creality-profile:"
+                    string extPrefix = Settings.GetSetting("SmExternalIdPrefix", "creality-profile:");
+                    if (!string.IsNullOrWhiteSpace(extPrefix))
+                    {
+                        string extId = extPrefix.Trim() + materialID + "|color:" + colorHex;
+                        fBodyDict.Add("external_id", extId);
+                    }
                     fBodyDict.Add("comment", "[CFS-RFID] Created by CFS RFID (color " + colorLabel + ")");
 
                     // Pull additional properties from the local Creality material DB entry, when available
